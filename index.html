<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Calculator</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="styles/style.css">
    </head>
    <body>
        <div id="display">
            <label> The output is: </label>
            <output id="displayOutput" name="myOutput"></output>
        </div>

        <div id = "buttons" >
            <input id="decimalInput" class="operand" value="." type="button">
            <input id="zeroInput" class="operand" value="0" type="button">
            <input id="oneInput" class="operand" value="1" type="button">
            <input id="twoInput" class="operand" value="2" type="button">
            <input id="threeInput" class="operand" value="3" type="button">
            <input id="fourInput" class="operand" value="4" type="button">
            <input id="fiveInput" class="operand" value="5" type="button">
            <input id="sixInput" class="operand" value="6" type="button">
            <input id="seventInput" class="operand" value="7" type="button">
            <input id="eightInput" class="operand" value="8" type="button">
            <input id="nineInput" class="operand" value="9" type="button">
            <input id="addInput" class="signOperator" value="+" type="button">
            <input id="subtractInput" class="signOperator" value="-" type="button">
            <input id="multiplyInput" class="signOperator" value="x" type="button">
            <input id="divideInput" class="signOperator" value="/" type="button">
            <input id="equalInput" class="signOperator" value="=" type="button">
            <input id="openBracketInput" class="operator" value="(" type="button">
            <input id="closeBracketInput" class="operator" value=")" type="button">
            <input id="ClearInput" class="operator" value="Clear" type="button">
            <input id="BackInput" class="operator" value="Back" type="button">
        </div>

        <script>
            let decimalAllowed = true
            let outputID = document.getElementById("displayOutput")

            let operandContainer = document.querySelectorAll(".operand")
            operandContainer.forEach(operand => {
                operand.addEventListener('click', (e) => {
                    operand = e.target.value

                    if(operand != "." || decimalAllowed) {
                        if (operand == ".") decimalAllowed = false
                        outputID.textContent += operand
                    }  
                })
            })

            let signOperatorContainer = document.querySelectorAll(".signOperator")
            signOperatorContainer.forEach(signOperator => {
                signOperator.addEventListener('click', (e) => {
                    operator = e.target.value

                    if (operator == "=") {
                        // const expression = outputID.textContent
                        let expressionCalc = operate(outputID.textContent)
                        if (expressionCalc == "Infinity") outputID.textContent = "Not gonna happen"

                        if (!isInt(expressionCalc)) {
                            expressionCalc = expressionCalc.toFixed(3)
                        }
                        outputID.textContent = expressionCalc
                        console.log(expressionCalc)
                        return
                    }

                    const previousCharacter = outputID.textContent.slice(-1)
                    const signOperators = ['+', '-', 'x', '/', ""]
                    if (signOperators.indexOf(previousCharacter) == -1) {
                        outputID.textContent += e.target.value
                        decimalAllowed = true
                    }
                })
            })

            let operatorContainer = document.querySelectorAll(".operator")
                operatorContainer.forEach(operator => {
                    operator.addEventListener('click', (e) => {
                        operator = e.target.value

                        if (operator == "Back") {
                            outputID.textContent = outputID.textContent.slice(0, -1)
                        }
                        else if (operator == "Clear") {
                            outputID.textContent = ""
                            decimalAllowed = true
                        }
                        else if (operator == ")") {
                            outputID.textContent += operator
                            decimalAllowed = false
                        }
                        else {
                            outputID.textContent += operator
                            decimalAllowed = true
                        }
                    })
                })

            function operate(str) {
                const regexMultiplySign = /x/g 
                const regexOpeningBracket = /(?<=[0-9\.])\(/g
                const regexClosingBracket = /\)(?=[0-9\.])/g
                
                let strRegex = str
                            .replace(regexMultiplySign, '*')
                            .replace(regexOpeningBracket, '*(')
                            .replace(regexClosingBracket, ')*')

                console.log(strRegex)
                return Function(`'use strict'; return (${strRegex})`)()
            }

            function isInt(n) {
                return n % 1 ? false : true
            }
        </script>
    </body>
</html>